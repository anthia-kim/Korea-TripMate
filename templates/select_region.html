<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>지역 선택</title>
    <script>
        async function loadCities() {
            const citySelect = document.getElementById("city");
            const response = await fetch("/get_cities");
            const data = await response.json();
            const cities = data.cities;

            if (!cities || cities.length === 0) {
                alert("시/도 정보를 불러올 수 없습니다.");
                return;
            }

            cities.forEach(city => {
                const option = document.createElement("option");
                option.value = city.name;  // 또는 city.code
                option.text = city.name;
                citySelect.appendChild(option);
            });
        }

        async function loadDistricts() {
            const citySelect = document.getElementById("city");
            const selectedCityName = citySelect.value;
            const districtSelect = document.getElementById("district");
            districtSelect.innerHTML = "";

            if (!selectedCityName) return;

            // 먼저 city 이름을 코드로 바꾸기
            const cityResponse = await fetch("/get_cities");
            const cityData = await cityResponse.json();
            const matched = cityData.cities.find(c => c.name === selectedCityName);
            if (!matched) return;

            const areaCode = matched.code;
            const response = await fetch(`/get_districts?area_code=${areaCode}`);
            const districts = await response.json();

            districts.forEach(district => {
                const option = document.createElement("option");
                option.value = district.name;
                option.text = district.name;
                districtSelect.appendChild(option);
            });
        }

        window.onload = loadCities;
    </script>
</head>
<body>
    <h1>지역을 선택하세요 ({{ category }})</h1>
    <form action="/show_recommendations" method="post">
        <input type="hidden" name="category" value="{{ category }}">

        <label>시/도 선택:
            <select id="city" name="city" onchange="loadDistricts()" required>
                <option value="">-- 선택하세요 --</option>
            </select>
        </label><br><br>

        <label>시군구 선택:
            <select id="district" name="district" required>
                <option value="">-- 먼저 시/도를 선택하세요 --</option>
            </select>
        </label><br><br>

        <button type="submit">추천 보기</button>
    </form>
</body>
</html>
